---
version: v2
name: "js-test-app" # require app name in definition going forward
services:
  example-web:
    type: web # optional if suffix -web is used
    run: node index.js
    port: 8080 # no need to nest this in container
    cpuCores: 0.1
    ramMegabytes: 256
    autoscaling:
      enabled: true 
      minInstances: 1
      maxInstances: 3
      memoryThresholdPercent: 60 # optional if targetCPUPercent is set
      cpuThresholdPercent: 60 # optional if targetMemory is set
    private: false # if set to true
    domains: # no need for custom_domain flag, just set this
      - name: test1.example.com
      - name: test2.example.com
    healthCheck:
      enabled: true
      httpPath: /healthz

  example-wkr:
    type: worker
    run: echo 'work'
    port: 80
    cpuCores: 0.1
    ramMegabytes: 256
    instances: 1

  # autoscaling can also be set, but instances would be ignored
  example-job:
    type: job
    run: echo 'hello world'
    allowConcurrent: true # job specific setting
    cpuCores: 0.1
    ramMegabytes: 256
    cron: "*/10 * * * *" # optional, job specific

predeploy:
  type: job
  run: ls
  # other job fields can be set, cron and allowConcurrent ignored

env:
  PORT: 8080
  NODE_ENV: production
